---
title: "Nuclear Data Mapping"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    theme : sandstone #readable #spacelab
    logo: www/logo.jpg
    includes:
      after_body: html/footer.html
    #css: mystyles.css
params:
  SYMAMLIBVER: "U-233-g-JEFF-3.3"
  LIBVER2: "JEFF-3.2"
  
---
<style>                     
.navbar {
  background-color:white;
  border-color:gray;
}
.navbar-brand {
color:DarkSlateGray!important;
}
.dataTables_wrapper{
font-family: helvetica;
font-size: 11px; 
}

</style>  

```{r sourcing global.R}
knitr::opts_chunk$set(echo = FALSE)
source('global_vars.R')  

setwd('../Rmd/')
```

MF/MT Map
================

```{r child='barheader_lib.Rmd'}
```

### MF-MT Origin {data-height=500}

```{r plotmap}
##plot_map : 
     
    #pdf<-df%>%subset(X==mX & A==mA & M==mM & LIBVER==mLIBVER)
    #tot<-dim(pdf)[1]
 
    title<-paste(mSYMAM," from ", mLIBVER)
    
    axisfont <- list(
      family = "Helvetica",
      size = 14,
      color = "blue"
    )
    
    yaxis=list(titlefont= axisfont)
    xaxis=list( 
      titlefont= axisfont,
      title = "MT",
      zeroline = FALSE,
      showline = FALSE,
      showticklabels = TRUE,
      showgrid = TRUE,
      tickangle=80
    )
    
    #changing column names for better readability in tooltip : 
    setnames(pdf, old=c("MFDES","MTDES", "LIBVERORIG"), new=c("Type","Reaction", "Matches"))
    
    g1<-ggplot(pdf, aes(x=MT, y=MF, Type=Type, Reaction=Reaction)) + 
      geom_tile(aes(fill=Matches)) +
      #geom_tile() +
      scale_y_discrete(drop=FALSE) + 
      scale_fill_manual(values=my_colors)+
      theme_light() + 
      theme(legend.title=element_blank(), 
            plot.background=element_rect(fill="white"), #can be 'darkseagreen' too...
            plot.margin = unit(c(0.7, 0, 2, 1), "cm")) #top, right, bottom, left
    p<-ggplotly(g1, width = 1200, 
                height = 500
                )
    #print(g1)
    
    p%>%config(displayModeBar = 'pan',showLink=FALSE,senddata=FALSE,editable=FALSE,
                 displaylogo=FALSE, collaborate=FALSE, cloud=FALSE,
                 modeBarButtonsToRemove=c('select2d', 'lasso2d','hoverClosestCartesian',
                                          'hoverCompareCartesian'))%>%
      layout(#title=title,
             autosize = F,
             yaxis=yaxis ,
             xaxis=xaxis ,
             showlegend = TRUE
             )
   p
   #plotly_IMAGE(p, format = "png", out_file = "plotmap.png")
```
   
Updated
===========

```{r child='barheader_table.Rmd'}
```

### Updated 

Origin of **updated** sections in `r mLIBVER` file,  with respect to reference : `r params$LIBVER2`  

```{r table_updated} 
  d<-comp%>%subset(LIB1!=LIB2 | is.na(LIB1) | is.na(LIB2)) # diff occurrences 
  data.table::setnames(d, old=c("LIB1","LIB2"), new=c(mLIBVER,params$LIBVER2))
  datatable(d, filter='top', options = list(
    pageLength=10,
    rownames=FALSE,
    autowidth=FALSE,
    #scrollY="1000vh",
    columnDefs=list(list(className='dt-center', targets=0:6))
    ))
  

```


Unchanged
===========

```{r child='barheader_table.Rmd'}
```

### Unchanged  

Origin of **identical** sections in `r mLIBVER` file, with respect to reference : `r params$LIBVER2` 

```{r table_same} 
  s<-comp%>%subset(LIB1==LIB2) # same occurrences 
  s<-subset(s, select = c('MF TYPE', 'MT TYPE', 'MF', 'MT', 'LIB1'))
  data.table::setnames(s, old=c("LIB1"), new=c("Origin"))
  datatable(s, filter='top', options = list(
    pageLength=10,
    rownames=FALSE,
    autowidth=FALSE,
    #scrollY="100vh",
    columnDefs=list(list(className='dt-center', targets=0:5))
    ))
  

```


   