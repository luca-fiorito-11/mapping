---
title: "Nuclear Data Mapping"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    theme : readable #spacelab
    logo: logo.jpg
    #css: mystyles.css
params:
  X : "U"
  A : "238"
  SYMA: "U - 238"
  M : "g"
  LIBVER: "JEFF-3.3" 
  LIBVER2: "JEFF-3.2"
  
---
<style>                     
.navbar {
  background-color:white;
  border-color:gray;
}
.navbar-brand {
color:black!important;
}
.dataTables_wrapper{
font-family: helvetica;
font-size: 11px; 
}
</style>  

```{r setup}
knitr::opts_chunk$set(echo = FALSE)
```

```{r source, include=FALSE, cache = TRUE}
source('global.R') 

library("flexdashboard")

my_colors <- c(
  "JEFF-3.3"="#097C28",
  "JEFF-3.2"="#72FD7A",
  "JEFF-3.1.2"="#2CA743",
  "JEFF-3.1.1"="#3DBC51",
  "JEFF-3.1"="#4FD25E",
  "JEFF-3.0"="#60E76C",
  "JEFF-2.2"="#46f0f0",
  "JENDL-4.0"="#ff1493",
  "JENDL-3.3"="#ffc0cb",
  "JENDL-3.2"="#ffb6c1",
  "ENDFB-8.0"="#FFC129",
  "ENDFB-7.1"="#FADB32",
  "ENDFB-7.0"="#F5F63C",
  "ENDFB-6.8"="#F4F50A",
  "TENDL-2017"="#aa6e28",
  "TENDL-2016"="#fffac8",
  "TENDL-2015"="#800000",
  "TENDL-2014"="#aaffc3",
  "TENDL-2013"="#808000",
  "TENDL-2012"="#ffd8b1",
  "TENDL-2011"="#000080",
  "TENDL-2010"="#808080",
  "TENDL-2009"="#000000"
  )
```




Graph
=====================================  
 
Row {}
-------------------------------------
### {data-width=800}

 

### (December 2017){data-width=200}
```{r} 
flexdashboard::valueBox("jeff 3.3", icon="fa-folder", href="https://www.oecd-nea.org", color="#097C28")

```   

Row {}
-------------------------------------

### MF, MT Mapping of ENDF6 file according to MF-MT Origin {data-height=2500}

```{r plotmap}
library(ggplot2)
library(plotly)


##plot_map : 
    
    pdf<-filter(df, X==params$X, A==params$A, M==params$M, LIBVER==params$LIBVER)
    #pdf<-df_iso_lib()
    title<-paste(params$SYMA," from ", params$LIBVER)
    
    axisfont <- list(
      family = "Helvetica",
      size = 14,
      color = "blue"
    )
    
    yaxis=list(titlefont= axisfont)
    xaxis=list( 
      titlefont= axisfont,
      title = "MT",
      zeroline = FALSE,
      showline = FALSE,
      showticklabels = TRUE,
      showgrid = TRUE,
      tickangle=80
    )
       
    g1<-ggplot(pdf, aes(MT, MF)) + geom_tile(aes(fill=LIBVERORIG)) +
      scale_y_discrete(drop=FALSE)+ 
      scale_fill_manual(values=my_colors)+
      theme_light() + 
      theme(legend.title=element_blank(),  
            plot.background=element_rect(fill="white"), #can be 'darkseagreen' too...
            plot.margin = unit(c(0.7, 0, 2, 1), "cm")) #top, right, bottom, left
    
     
    
    p<-ggplotly(g1, width = 1200, height = 500)
    
    p%>%config(displayModeBar = 'pan',showLink=FALSE,senddata=FALSE,editable=FALSE,
                 displaylogo=FALSE, collaborate=FALSE, cloud=FALSE,
                 modeBarButtonsToRemove=c('select2d', 'lasso2d','hoverClosestCartesian',
                                          'hoverCompareCartesian'))%>%
      layout(title=title, autosize = F,  
             yaxis=yaxis , xaxis=xaxis)
   
    p 
    
```
   


Tables
=====================================  
 
Row {}
-------------------------------------
### {data-width=800}

 

### (December 2017){data-width=200}
```{r} 
flexdashboard::valueBox("jeff 3.3", icon="fa-folder", href="https://www.oecd-nea.org", color="#00cc99")

```   

Row {}
-------------------------------------

### **Different** data to previous release (JEFF-3.2)

```{r} 

  library(DT) 

  pdf<-filter(df, X==params$X, A==params$A, M==params$M)

  df<-filter(df, X=="U", A=="235", M=="g")
  
  lib1<-subset(filter(pdf, LIBVER==params$LIBVER),select = c('MF', 'MFDES', 'MT', "MTDES", 'LIBVER', 'LIBVERORIG'))
  lib2<-subset(filter(pdf, LIBVER==params$LIBVER2),select = c('MF', 'MFDES', 'MT', "MTDES", 'LIBVER', 'LIBVERORIG'))
  comp<-merge(lib1, lib2, by = c('MF', 'MFDES', 'MT', "MTDES"))
  
  data.table::setnames(comp, old=c("LIBVERORIG.x","LIBVERORIG.y"), new=c("LIB1","LIB2"))
  data.table::setnames(comp, old=c("MFDES","MTDES"), new=c("MF TYPE","MT TYPE"))
  
  comp<-subset(comp,
               select = c('MF TYPE', 'MT TYPE', 'MF', 'MT', 'LIB1', 'LIB2'))
  
  d<-filter(comp, LIB1!=LIB2) # diff occurrences 
  
  data.table::setnames(d, old=c("LIB1","LIB2"), new=c(params$LIBVER,params$LIBVER2))
  datatable(d, options = list(pageLength=50))
  

```



   